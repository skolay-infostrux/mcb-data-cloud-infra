databases:
  dw_prod_ingest:
    comment: "Prod Ingest"
    privileges:
      database:
        read:
          roles:
            - prod_ingest_read_role
        write:
          roles:
            - prod_ingest_admin_role
  dw_prod_clean:
    comment: "Prod Clean"
    privileges:
      database:
        read:
          roles:
            - prod_transform_read_role
        write:
          roles:
            - prod_transform_admin_role
  dw_prod_normalize:
    comment: "Prod Normalize"
    privileges:
      database:
        read:
          roles:
            - prod_transform_read_role
        write:
          roles:
            - prod_transform_admin_role
  dw_prod_integrate:
    comment: "Prod Integrate"
    privileges:
      database:
        read:
          roles:
            - prod_transform_read_role
        write:
          roles:
            - prod_transform_admin_role
  dw_prod_analyze:
    comment: "Prod Analyze"
    privileges:
      database:
        read:
          roles:
            - prod_analyze_read_role
        write:
          roles:
            - prod_analyze_admin_role
  dw_prod_egest:
    comment: "Prod Egest"
    privileges:
      database:
        read:
          roles:
            - prod_egest_read_role
        write:
          roles:
            - prod_egest_admin_role
  dw_prod_report:
    comment: "Prod Report"
    privileges:
      database:
        read:
          roles:
            - prod_report_read_role
        write:
          roles:
            - prod_report_admin_role
  dw_prod_log:
    comment: "Prod log"
    privileges:
      database:
        read:
          roles:
            - prod_transform_read_role
        write:
          roles:
            - prod_transform_admin_role

warehouses:
  prod_compute_wh:
    comment: "Prod warehouse for ad-hoc queries."
    size: "x-small"
    auto_suspend: 60
    auto_resume: true
  prod_dbt_wh:
    comment: "Prod dbt warehouse."
    size: "x-small"
    auto_suspend: 60
    auto_resume: true
    privileges:
      roles:
        - prod_dbt_service_role
  prod_ingest_wh:
    comment:  "Ingest warehouse."
    size: "x-small"
    auto_suspend: 60
    auto_resume: true
    privileges:
      roles:
        - prod_ingest_service_role
  prod_egress_wh:
    comment: "Prod Egest warehouse."
    size: "x-small"
    auto_suspend: 60
    auto_resume: true
    privileges:
      roles:
        - prod_egest_service_role
  prod_pbi_wh:
    comment: "Prod PBI warehouse."
    size: "x-small"
    auto_suspend: 60
    auto_resume: true
    privileges:
      roles:
        - prod_report_service_role

users:
  prod_dbt_user:
    comment: "dbt user to build Snowflake models."
    default_role: "prod_dbt_service_role"
    default_warehouse: "prod_dbt_wh"
    disabled: false
    display_name: "Prod dbt"
    login_name: "prod_dbt_user"
  prod_ingest_user:
    comment: "User to ingest data."
    default_role: "prod_ingest_service_role"
    default_warehouse: "prod_ingest_wh"
    disabled: false
    display_name: "Prod"
    login_name: " prod_ingest_user"
  prod_egress_user:
    comment: "User to egest Prod data."
    default_role: "prod_egest_service_role"
    default_warehouse: "prod_egress_wh"
    disabled: false
    display_name: "Prod"
    login_name: "prod_egress_user"
  prod_pbi_user:
    comment: "User to report Prod data."
    default_role: "prod_report_service_role"
    default_warehouse: "prod_pbi_wh"
    disabled: false
    display_name: "Prod"
    login_name: "prod_pbi_user"    

roles:
  prod_ingest_read_role:
    comment: "Prod ingestion layer's read only access."
    grant_to:
      roles:
        - prod_transformer_role
  prod_ingest_admin_role:
    comment: "Ingestion layer's highest level of access."
    grant_to:
      roles:
        - prod_admin_role
        - prod_ingest_service_role
  prod_transform_read_role:
    comment: "Transform prod layer's read only access."
    grant_to:
      roles:
        - prod_transform_admin_role
  prod_transform_admin_role:
    comment: "Transform prod layer's highest level of access."
    grant_to:
      roles:
        - prod_transformer_role
  prod_analyze_read_role:
    comment: "Analyze prod layer's read only access."
    grant_to:
      roles:
        - prod_analyze_admin_role
  prod_analyze_admin_role:
    comment: "Analyze prod layer's highest level of access."
    grant_to:
      roles:
        - prod_transformer_role
  prod_egest_read_role:
    comment: "Egest prod layer's read only access."
    grant_to:
      roles:
        - prod_egest_admin_role
        - prod_egest_service_role
  prod_egest_admin_role:
    comment: "Egest prod layer's highest level of access."
    grant_to:
      roles:
        - prod_transformer_role
  prod_report_read_role:
    comment: "report prod layer's read only access."
    grant_to:
      roles:
        - prod_report_admin_role
        - prod_report_service_role
  prod_report_admin_role:
    comment: "report prod layer's highest level of access."
    grant_to:
      roles:
        - prod_transformer_role
  env_admin_role:
    comment: "All environment's highest level of access. Creator of all databases"
    grant_to:
      roles:
        - sysadmin
  prod_transformer_role:
    comment: "Prod environment's tranformation role. Read-only on Ingest"
    grant_to:
      roles:
        - prod_dbt_service_role
        - prod_admin_role
  prod_admin_role:
    comment: "Prod environment's highest level of access."
    grant_to:
      roles:
        - env_admin_role
  prod_ingest_service_role:
    comment: "Data source service role."
    grant_to:
      users:
        - prod_ingest_user
  prod_egest_service_role:
    comment: "Prod data destination service role."
    grant_to:
      users:
        - prod_egress_user
  prod_report_service_role:
    comment: "Prod data destination service role."
    grant_to:
      users:
        - prod_egress_user
        - prod_pbi_user
  prod_dbt_service_role:
    comment: "dbt prod service role."
    grant_to:
      users:
        - prod_dbt_user
